#!/usr/bin/env bash

echo "--- Running Matteo Icardi's handy script: pdfreducesize_gray ---"

if ! command -v gs &> /dev/null; then
    echo "Error: 'gs' (Ghostscript) is not installed." >&2
    exit 1
fi

if [ -z "$1" ]; then
    echo "Usage: $(basename "$0") <input.pdf>"
    exit 1
fi

INPUT_FILE="$1"
OUTPUT_FILE="compressed${INPUT_FILE}"

echo "Reducing size (grayscale) of '$INPUT_FILE' -> '$OUTPUT_FILE'..."

gs -q -dNOPAUSE -dBATCH -dSAFER \
    -sPAPERSIZE=a4 \
    -sDEVICE=pdfwrite \
    -dCompatibilityLevel=1.3 \
    -dPDFSETTINGS=/screen \
    -dEmbedAllFonts=true \
    -dSubsetFonts=true \
    -sDEVICE=pdfwrite \
    -sColorConversionStrategy=Gray \
    -dProcessColorModel=/DeviceGray \
    -dGrayImageDownsampleType=/Bicubic \
    -dGrayImageResolution=300 \
    -dMonoImageDownsampleType=/Bicubic \
    -dMonoImageResolution=300 \
    -sOutputFile="$OUTPUT_FILE" \
    "$INPUT_FILE"

echo "Done."

